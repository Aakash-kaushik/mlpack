\doxysection{Introduction}\label{akfntutorial_intro_akfntut}
{\bfseries{mlpack}} implements multiple strategies for approximate furthest neighbor search in its {\ttfamily mlpack\+\_\+approx\+\_\+kfn} and {\ttfamily mlpack\+\_\+kfn} programs (each program corresponds to different techniques). This tutorial discusses what problems these algorithms solve and how to use each of the techniques that {\bfseries{mlpack}} implements.

{\bfseries{mlpack}} implements five approximate furthest neighbor search algorithms\+:


\begin{DoxyItemize}
\item brute-\/force search (in {\ttfamily mlpack\+\_\+kfn})
\item single-\/tree search (in {\ttfamily mlpack\+\_\+kfn})
\item dual-\/tree search (in {\ttfamily mlpack\+\_\+kfn})
\item query-\/dependent approximate furthest neighbor (QDAFN) (in {\ttfamily mlpack\+\_\+approx\+\_\+kfn})
\item Drusilla\+Select (in {\ttfamily mlpack\+\_\+approx\+\_\+kfn})
\end{DoxyItemize}

These methods are described in the following papers\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{@inproceedings\{curtin2013tree,}
\DoxyCodeLine{  title=\{Tree-\/Independent Dual-\/Tree Algorithms\},}
\DoxyCodeLine{  author=\{Curtin, Ryan R. and March, William B. and Ram, Parikshit and Anderson,}
\DoxyCodeLine{      David V. and Gray, Alexander G. and Isbell Jr., Charles L.\},}
\DoxyCodeLine{  booktitle=\{Proceedings of The 30th International Conference on Machine}
\DoxyCodeLine{      Learning (ICML \textcolor{stringliteral}{'13)\},}}
\DoxyCodeLine{\textcolor{stringliteral}{  pages=\{1435-\/-\/1443\},}}
\DoxyCodeLine{\textcolor{stringliteral}{  year=\{2013\}}}
\DoxyCodeLine{\textcolor{stringliteral}{\}}}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{@incollection\{pagh2015approximate,}
\DoxyCodeLine{  title=\{Approximate furthest neighbor in high dimensions\},}
\DoxyCodeLine{  author=\{Pagh, Rasmus and Silvestri, Francesco and Sivertsen, Johan and Skala,}
\DoxyCodeLine{      Matthew\},}
\DoxyCodeLine{  booktitle=\{Similarity Search and Applications\},}
\DoxyCodeLine{  pages=\{3-\/-\/14\},}
\DoxyCodeLine{  year=\{2015\},}
\DoxyCodeLine{  publisher=\{Springer\}}
\DoxyCodeLine{\}}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{@incollection\{curtin2016fast,}
\DoxyCodeLine{  title=\{Fast approximate furthest neighbors with data-\/dependent candidate}
\DoxyCodeLine{      selection\},}
\DoxyCodeLine{  author=\{Curtin, Ryan R., and Gardner, Andrew B.\},}
\DoxyCodeLine{  booktitle=\{Similarity Search and Applications\},}
\DoxyCodeLine{  pages=\{221-\/-\/235\},}
\DoxyCodeLine{  year=\{2016\},}
\DoxyCodeLine{  publisher=\{Springer\}}
\DoxyCodeLine{\}}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{@article\{curtin2018exploiting,}
\DoxyCodeLine{  title=\{Exploiting the structure of furthest neighbor search \textcolor{keywordflow}{for} fast}
\DoxyCodeLine{      approximate results\},}
\DoxyCodeLine{  author=\{Curtin, Ryan R., and Echauz, Javier, and Gardner, Andrew B.\},}
\DoxyCodeLine{  journal=\{Information Systems\},}
\DoxyCodeLine{  year=\{2018\},}
\DoxyCodeLine{  publisher=\{Elsevier\}}
\DoxyCodeLine{\}}

\end{DoxyCode}


The problem of furthest neighbor search is simple, and is the opposite of the much-\/more-\/studied nearest neighbor search problem. Given a set of reference points $R$ (the set in which we are searching), and a set of query points $Q$ (the set of points for which we want the furthest neighbor), our goal is to return the $k$ furthest neighbors for each query point in $Q$\+:

\[ \operatorname{k-argmax}_{p_r \in R} d(p_q, p_r). \]

In order to solve this problem, {\bfseries{mlpack}} provides a number of interfaces.


\begin{DoxyItemize}
\item two \doxyref{simple command-\/line executables}{p.}{akfntutorial_cli_akfntut} to calculate approximate furthest neighbors
\item a simple \doxyref{C++ class for QDAFN}{p.}{akfntutorial_cpp_qdafn_akfntut}
\item a simple \doxyref{C++ class for Drusilla\+Select}{p.}{akfntutorial_cpp_ds_akfntut}
\item a simple \doxyref{C++ class for tree-\/based and brute-\/force}{p.}{akfntutorial_cpp_ns_akfntut} search
\end{DoxyItemize}\doxysection{Table of Contents}\label{akfntutorial_toc_akfntut}
A list of all the sections this tutorial contains.


\begin{DoxyItemize}
\item \doxyref{Introduction}{p.}{akfntutorial_intro_akfntut}
\item \doxyref{Table of Contents}{p.}{akfntutorial_toc_akfntut}
\item \doxyref{Which algorithm should be used?}{p.}{akfntutorial_which_akfntut}
\item \doxyref{Command-\/line \textquotesingle{}mlpack\+\_\+approx\+\_\+kfn\textquotesingle{} and \textquotesingle{}mlpack\+\_\+kfn\textquotesingle{}}{p.}{akfntutorial_cli_akfntut}
\begin{DoxyItemize}
\item \doxyref{Calculate 5 furthest neighbors with default options}{p.}{akfntutorial_cli_ex1_akfntut}
\item \doxyref{Specifying algorithm parameters for Drusilla\+Select}{p.}{akfntutorial_cli_ex2_akfntut}
\item \doxyref{Using QDAFN instead of Drusilla\+Select}{p.}{akfntutorial_cli_ex3_akfntut}
\item \doxyref{Printing results quality with exact distances}{p.}{akfntutorial_cli_ex4_akfntut}
\item \doxyref{Using cached exact distances for quality results}{p.}{akfntutorial_cli_ex5_akfntut}
\item \doxyref{Using tree-\/based approximation with mlpack\+\_\+kfn}{p.}{akfntutorial_cli_ex6_akfntut}
\item \doxyref{Different algorithms with \textquotesingle{}mlpack\+\_\+kfn\textquotesingle{}}{p.}{akfntutorial_cli_ex7_akfntut}
\item \doxyref{Saving a model for later use}{p.}{akfntutorial_cli_ex8_akfntut}
\item \doxyref{Final command-\/line program notes}{p.}{akfntutorial_cli_final_akfntut}
\end{DoxyItemize}
\item \doxyref{Drusilla\+Select C++ class}{p.}{akfntutorial_cpp_ds_akfntut}
\begin{DoxyItemize}
\item \doxyref{Approximate furthest neighbors with defaults}{p.}{akfntutorial_cpp_ex1_ds_akfntut}
\item \doxyref{Custom numbers of tables and projections}{p.}{akfntutorial_cpp_ex2_ds_akfntut}
\item \doxyref{Accessing the candidate set}{p.}{akfntutorial_cpp_ex3_ds_akfntut}
\item \doxyref{Retraining on a new reference set}{p.}{akfntutorial_cpp_ex4_ds_akfntut}
\item \doxyref{Running on sparse data}{p.}{akfntutorial_cpp_ex5_ds_akfntut}
\end{DoxyItemize}
\item \doxyref{QDAFN C++ class}{p.}{akfntutorial_cpp_qdafn_akfntut}
\begin{DoxyItemize}
\item \doxyref{Approximate furthest neighbors with defaults}{p.}{akfntutorial_cpp_ex1_qdafn_akfntut}
\item \doxyref{Custom numbers of tables and projections}{p.}{akfntutorial_cpp_ex2_qdafn_akfntut}
\item \doxyref{Accessing the candidate set}{p.}{akfntutorial_cpp_ex3_qdafn_akfntut}
\item \doxyref{Retraining on a new reference set}{p.}{akfntutorial_cpp_ex4_qdafn_akfntut}
\item \doxyref{Running on sparse data}{p.}{akfntutorial_cpp_ex5_qdafn_akfntut}
\end{DoxyItemize}
\item \doxyref{KFN C++ class}{p.}{akfntutorial_cpp_ns_akfntut}
\begin{DoxyItemize}
\item \doxyref{Simple furthest neighbors example}{p.}{akfntutorial_cpp_ex1_ns_akfntut}
\item \doxyref{Retraining on a new reference set}{p.}{akfntutorial_cpp_ex2_ns_akfntut}
\item \doxyref{Searching in single-\/tree mode}{p.}{akfntutorial_cpp_ex3_ns_akfntut}
\item \doxyref{Searching in brute-\/force mode}{p.}{akfntutorial_cpp_ex4_ns_akfntut}
\end{DoxyItemize}
\item \doxyref{Further documentation}{p.}{akfntutorial_further_doc_akfntut}
\end{DoxyItemize}\doxysection{Which algorithm should be used?}\label{akfntutorial_which_akfntut}
There are three algorithms for furthest neighbor search that {\bfseries{mlpack}} implements, and each is suited to a different setting. Below is some basic guidance on what should be used. Note that the question of \char`\"{}which algorithm should be used\char`\"{} is a very difficult question to answer, so the guidance below is just that---guidance---and may not be right for a particular problem.


\begin{DoxyItemize}
\item {\ttfamily Drusilla\+Select} is very fast and will perform extremely well for datasets with outliers or datasets with structure (like low-\/dimensional datasets embedded in high dimensions)
\item {\ttfamily QDAFN} is a random approach and therefore should be well-\/suited for datasets with little to no structure
\item The tree-\/based approaches (the {\ttfamily KFN} class and the {\ttfamily mlpack\+\_\+kfn} program) is best suited for low-\/dimensional datasets, and is most effective when very small levels of approximation are desired, or when exact results are desired.
\item Dual-\/tree search is most useful when the query set is large and structured (like for all-\/furthest-\/neighbor search).
\item Single-\/tree search is more useful when the query set is small.
\end{DoxyItemize}\doxysection{Command-\/line \textquotesingle{}mlpack\+\_\+approx\+\_\+kfn\textquotesingle{} and \textquotesingle{}mlpack\+\_\+kfn\textquotesingle{}}\label{akfntutorial_cli_akfntut}
{\bfseries{mlpack}} provides two command-\/line programs to solve approximate furthest neighbor search\+:


\begin{DoxyItemize}
\item {\ttfamily mlpack\+\_\+approx\+\_\+kfn}, for the QDAFN and Drusilla\+Select approaches
\item {\ttfamily mlpack\+\_\+kfn}, for exact and approximate tree-\/based approaches
\end{DoxyItemize}

These two programs allow a large number of algorithms to be used to find approximate furthest neighbors. Note that the {\ttfamily mlpack\+\_\+kfn} program is also documented by the \doxyref{Command-\/\+Line \textquotesingle{}mlpack\+\_\+knn\textquotesingle{}}{p.}{nstutorial_cli_nstut} section of the \doxyref{Neighbor\+Search tutorial (k-\/nearest-\/neighbors)}{p.}{nstutorial} page, as it shares options with the {\ttfamily mlpack\+\_\+knn} program.

Below are several examples of how the {\ttfamily mlpack\+\_\+approx\+\_\+kfn} and {\ttfamily mlpack\+\_\+kfn} programs might be used. The first examples focus on the {\ttfamily mlpack\+\_\+approx\+\_\+kfn} program, and the last few show how {\ttfamily mlpack\+\_\+kfn} can be used to produce approximate results.\doxysubsection{Calculate 5 furthest neighbors with default options}\label{akfntutorial_cli_ex1_akfntut}
Here we have a query dataset {\ttfamily queries.\+csv} and a reference dataset {\ttfamily refs.\+csv} and we wish to find the 5 furthest neighbors of every query point in the reference dataset. We may do that with the {\ttfamily mlpack\+\_\+approx\+\_\+kfn} algorithm, using the default of the {\ttfamily Drusilla\+Select} algorithm with default parameters.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 5 -\/n n.csv -\/d d.csv}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building DrusillaSelect model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 5 furthest neighbors with DrusillaSelect...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: ds}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 5}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   num\_projections: 5}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   drusilla\_select\_construct: 0.000342s}
\DoxyCodeLine{[INFO ]   drusilla\_select\_search: 0.000780s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.010689s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.005585s}
\DoxyCodeLine{[INFO ]   total\_time: 0.018592s}

\end{DoxyCode}


Convenient timers for parts of the program operation are printed. The results, saved in {\ttfamily n.\+csv} and {\ttfamily d.\+csv}, indicate the furthest neighbors and distances for each query point. The row of the output file indicates the query point that the results are for. The neighbors are listed from furthest to nearest; so, the 4th element in the 3rd row of {\ttfamily d.\+csv} indicates the distance between the 3rd query point in {\ttfamily queries.\+csv} and its approximate 4th furthest neighbor. Similarly, the same element in {\ttfamily n.\+csv} indicates the index of the approximate 4th furthest neighbor (with respect to {\ttfamily refs.\+csv}).\doxysubsection{Specifying algorithm parameters for Drusilla\+Select}\label{akfntutorial_cli_ex2_akfntut}
The {\ttfamily -\/p} ({\ttfamily --num\+\_\+projections}) and {\ttfamily -\/t} ({\ttfamily --num\+\_\+tables}) parameters affect the running of the {\ttfamily Drusilla\+Select} algorithm and the QDAFN algorithm. Specifically, larger values for each of these parameters will search more possible candidate furthest neighbors and produce better results (at the cost of runtime). More details on how each of these parameters works is available in the original papers, the {\bfseries{mlpack}} source, or the documentation given by {\ttfamily --help}.

In the example below, we run {\ttfamily Drusilla\+Select} to find 4 furthest neighbors using 10 tables and 2 points in each table. In this case we have chosen to omit the {\ttfamily -\/n} {\ttfamily n.\+csv} option, meaning that only the output candidate distances will be written to {\ttfamily d.\+csv}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 4 -\/n n.csv -\/d d.csv -\/t 10 -\/p 2}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building DrusillaSelect model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 4 furthest neighbors with DrusillaSelect...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: ds}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 4}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   num\_projections: 2}
\DoxyCodeLine{[INFO ]   num\_tables: 10}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   drusilla\_select\_construct: 0.000645s}
\DoxyCodeLine{[INFO ]   drusilla\_select\_search: 0.000551s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.008518s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.003734s}
\DoxyCodeLine{[INFO ]   total\_time: 0.014019s}

\end{DoxyCode}
\doxysubsection{Using QDAFN instead of Drusilla\+Select}\label{akfntutorial_cli_ex3_akfntut}
The algorithm to be used for approximate furthest neighbor search can be specified with the {\ttfamily --algorithm} ({\ttfamily -\/a}) option to the {\ttfamily mlpack\+\_\+approx\+\_\+kfn} program. Below, we use the QDAFN algorithm instead of the default. We leave the {\ttfamily -\/p} and {\ttfamily -\/t} options at their defaults---even though QDAFN often requires more tables and points to get the same quality of results.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 3 -\/n n.csv -\/d d.csv -\/a qdafn}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building QDAFN model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 3 furthest neighbors with QDAFN...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: qdafn}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 3}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   num\_projections: 5}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   loading\_data: 0.008380s}
\DoxyCodeLine{[INFO ]   qdafn\_construct: 0.003399s}
\DoxyCodeLine{[INFO ]   qdafn\_search: 0.000886s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.002253s}
\DoxyCodeLine{[INFO ]   total\_time: 0.015465s}

\end{DoxyCode}
\doxysubsection{Printing results quality with exact distances}\label{akfntutorial_cli_ex4_akfntut}
The {\ttfamily mlpack\+\_\+approx\+\_\+kfn} program can calculate the quality of the results if the {\ttfamily --calculate\+\_\+error} ({\ttfamily -\/e}) flag is specified. Below we use the program with its default parameters and calculate the error, which is displayed in the output. The error is only calculated for the furthest neighbor, not all k; therefore, in this example we have set {\ttfamily -\/k} to {\ttfamily 1}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 1 -\/e -\/q -\/n n.csv}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building DrusillaSelect model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 1 furthest neighbors with DrusillaSelect...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Calculating exact distances...}
\DoxyCodeLine{[INFO ] 28891 node combinations were scored.}
\DoxyCodeLine{[INFO ] 37735 base cases were calculated.}
\DoxyCodeLine{[INFO ] Calculation complete.}
\DoxyCodeLine{[INFO ] Average error: 1.08417.}
\DoxyCodeLine{[INFO ] Maximum error: 1.28712.}
\DoxyCodeLine{[INFO ] Minimum error: 1.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: ds}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 3}
\DoxyCodeLine{[INFO ]   neighbors\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   num\_projections: 5}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   computing\_neighbors: 0.001476s}
\DoxyCodeLine{[INFO ]   drusilla\_select\_construct: 0.000309s}
\DoxyCodeLine{[INFO ]   drusilla\_select\_search: 0.000495s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.008462s}
\DoxyCodeLine{[INFO ]   total\_time: 0.011670s}
\DoxyCodeLine{[INFO ]   tree\_building: 0.000202s}

\end{DoxyCode}


Note that the output includes three lines indicating the error\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{[INFO ] Average error: 1.08417.}
\DoxyCodeLine{[INFO ] Maximum error: 1.28712.}
\DoxyCodeLine{[INFO ] Minimum error: 1.}

\end{DoxyCode}


In this case, a minimum error of 1 indicates an exact result, and over the entire query set the algorithm has returned a furthest neighbor candidate with maximum error 1.\+28712.\doxysubsection{Using cached exact distances for quality results}\label{akfntutorial_cli_ex5_akfntut}
However, for large datasets, calculating the error may take a long time, because the exact furthest neighbors must be calculated. Therefore, if the exact furthest neighbor distances are already known, they may be passed in with the {\ttfamily --exact\+\_\+distances\+\_\+file} ({\ttfamily -\/x}) option in order to avoid the calculation. In the example below, we assume {\ttfamily exact.\+csv} contains the exact furthest neighbor distances. We run the {\ttfamily qdafn} algorithm in this example.

Note that the {\ttfamily -\/e} option must be specified for the {\ttfamily -\/x} option have any effect.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/q queries.csv -\/r refs.csv -\/k 1 -\/e -\/x exact.csv -\/n n.csv -\/v -\/a qdafn}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building QDAFN model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 1 furthest neighbors with QDAFN...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'exact.csv'} as raw ASCII formatted data.  Size is 1 x 1000.}
\DoxyCodeLine{[INFO ] Average error: 1.06914.}
\DoxyCodeLine{[INFO ] Maximum error: 1.67407.}
\DoxyCodeLine{[INFO ] Minimum error: 1.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: qdafn}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: exact.csv}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 1}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   num\_projections: 5}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   loading\_data: 0.010348s}
\DoxyCodeLine{[INFO ]   qdafn\_construct: 0.000318s}
\DoxyCodeLine{[INFO ]   qdafn\_search: 0.000793s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.000259s}
\DoxyCodeLine{[INFO ]   total\_time: 0.012254s}

\end{DoxyCode}
\doxysubsection{Using tree-\/based approximation with mlpack\+\_\+kfn}\label{akfntutorial_cli_ex6_akfntut}
The {\ttfamily mlpack\+\_\+kfn} algorithm allows specifying a desired approximation level with the {\ttfamily --epsilon} ({\ttfamily -\/e}) option. The parameter must be greater than or equal to 0 and less than 1. A setting of 0 indicates exact search.

The example below runs dual-\/tree furthest neighbor search (the default algorithm) with the approximation parameter set to 0.\+5.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 3 -\/e 0.5 -\/n n.csv -\/d d.csv}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Loaded reference data from \textcolor{stringliteral}{'refs.csv'} (3x1000).}
\DoxyCodeLine{[INFO ] Building reference tree...}
\DoxyCodeLine{[INFO ] Tree built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Loaded query data from \textcolor{stringliteral}{'queries.csv'} (3x1000).}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 3 neighbors with dual-\/tree kd-\/tree search...}
\DoxyCodeLine{[INFO ] 1611 node combinations were scored.}
\DoxyCodeLine{[INFO ] 13938 base cases were calculated.}
\DoxyCodeLine{[INFO ] 1611 node combinations were scored.}
\DoxyCodeLine{[INFO ] 13938 base cases were calculated.}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: dual\_tree}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   epsilon: 0.5}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 3}
\DoxyCodeLine{[INFO ]   leaf\_size: 20}
\DoxyCodeLine{[INFO ]   naive: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   percentage: 1}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   random\_basis: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   seed: 0}
\DoxyCodeLine{[INFO ]   single\_mode: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   tree\_type: kd}
\DoxyCodeLine{[INFO ]   true\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   true\_neighbors\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   computing\_neighbors: 0.000442s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.008060s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.002850s}
\DoxyCodeLine{[INFO ]   total\_time: 0.012667s}
\DoxyCodeLine{[INFO ]   tree\_building: 0.000251s}

\end{DoxyCode}


Note that the format of the output files {\ttfamily d.\+csv} and {\ttfamily n.\+csv} are the same as for {\ttfamily mlpack\+\_\+approx\+\_\+kfn}.\doxysubsection{Different algorithms with \textquotesingle{}mlpack\+\_\+kfn\textquotesingle{}}\label{akfntutorial_cli_ex7_akfntut}
The {\ttfamily mlpack\+\_\+kfn} program offers a large number of different algorithms that can be used. The {\ttfamily --algorithm} ({\ttfamily -\/a}) may be used to specify three main different algorithm types\+: {\ttfamily naive} (brute-\/force search), {\ttfamily single\+\_\+tree} (single-\/tree search), {\ttfamily dual\+\_\+tree} (dual-\/tree search, the default), and {\ttfamily greedy} (\char`\"{}defeatist\char`\"{} greedy search, which goes to one leaf node of the tree then terminates). The example below uses single-\/tree search to find approximate neighbors with epsilon set to 0.\+1.


\begin{DoxyCode}{0}
\DoxyCodeLine{mlpack\_kfn -\/q queries.csv -\/r refs.csv -\/v -\/k 3 -\/e 0.1 -\/n n.csv -\/d d.csv -\/a single\_tree}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Loaded reference data from \textcolor{stringliteral}{'refs.csv'} (3x1000).}
\DoxyCodeLine{[INFO ] Building reference tree...}
\DoxyCodeLine{[INFO ] Tree built.}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Loaded query data from \textcolor{stringliteral}{'queries.csv'} (3x1000).}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 3 neighbors with single-\/tree kd-\/tree search...}
\DoxyCodeLine{[INFO ] 13240 node combinations were scored.}
\DoxyCodeLine{[INFO ] 15924 base cases were calculated.}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: single\_tree}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   epsilon: 0.1}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 3}
\DoxyCodeLine{[INFO ]   leaf\_size: 20}
\DoxyCodeLine{[INFO ]   naive: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   percentage: 1}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   random\_basis: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   seed: 0}
\DoxyCodeLine{[INFO ]   single\_mode: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   tree\_type: kd}
\DoxyCodeLine{[INFO ]   true\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   true\_neighbors\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   computing\_neighbors: 0.000850s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.007858s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.003445s}
\DoxyCodeLine{[INFO ]   total\_time: 0.013084s}
\DoxyCodeLine{[INFO ]   tree\_building: 0.000250s}

\end{DoxyCode}
\doxysubsection{Saving a model for later use}\label{akfntutorial_cli_ex8_akfntut}
The {\ttfamily mlpack\+\_\+approx\+\_\+kfn} and {\ttfamily mlpack\+\_\+kfn} programs both allow models to be saved and loaded for future use. The {\ttfamily --output\+\_\+model\+\_\+file} ({\ttfamily -\/M}) option allows specifying where to save a model, and the {\ttfamily --input\+\_\+model\+\_\+file} ({\ttfamily -\/m}) option allows a model to be loaded instead of trained. So, if you specify {\ttfamily --input\+\_\+model\+\_\+file} then you do not need to specify {\ttfamily --reference\+\_\+file} ({\ttfamily -\/r}), {\ttfamily --num\+\_\+projections} ({\ttfamily -\/p}), or {\ttfamily --num\+\_\+tables} ({\ttfamily -\/t}).

The example below saves a model with 10 projections and 5 tables. Note that neither {\ttfamily --query\+\_\+file} ({\ttfamily -\/q}) nor {\ttfamily -\/k} are specified; this run only builds the model and saves it to {\ttfamily model.\+bin}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/r refs.csv -\/t 5 -\/p 10 -\/v -\/M model.bin}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'refs.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Building DrusillaSelect model...}
\DoxyCodeLine{[INFO ] Model built.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: ds}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   k: 0}
\DoxyCodeLine{[INFO ]   neighbors\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   num\_projections: 10}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: model.bin}
\DoxyCodeLine{[INFO ]   query\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   reference\_file: refs.csv}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   drusilla\_select\_construct: 0.000321s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.004700s}
\DoxyCodeLine{[INFO ]   total\_time: 0.007320s}

\end{DoxyCode}


Now, with the model saved, we can run approximate furthest neighbor search on a query set using the saved model\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$ mlpack\_approx\_kfn -\/m model.bin -\/q queries.csv -\/k 3 -\/d d.csv -\/n n.csv -\/v}
\DoxyCodeLine{[INFO ] Loading \textcolor{stringliteral}{'queries.csv'} as CSV data.  Size is 3 x 1000.}
\DoxyCodeLine{[INFO ] Searching \textcolor{keywordflow}{for} 3 furthest neighbors with DrusillaSelect...}
\DoxyCodeLine{[INFO ] Search complete.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'n.csv'}.}
\DoxyCodeLine{[INFO ] Saving CSV data to \textcolor{stringliteral}{'d.csv'}.}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Execution parameters:}
\DoxyCodeLine{[INFO ]   algorithm: ds}
\DoxyCodeLine{[INFO ]   calculate\_error: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   distances\_file: d.csv}
\DoxyCodeLine{[INFO ]   exact\_distances\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   help: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]   info: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   input\_model\_file: model.bin}
\DoxyCodeLine{[INFO ]   k: 3}
\DoxyCodeLine{[INFO ]   neighbors\_file: n.csv}
\DoxyCodeLine{[INFO ]   num\_projections: 5}
\DoxyCodeLine{[INFO ]   num\_tables: 5}
\DoxyCodeLine{[INFO ]   output\_model\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   query\_file: queries.csv}
\DoxyCodeLine{[INFO ]   reference\_file: \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{[INFO ]   verbose: \textcolor{keyword}{true}}
\DoxyCodeLine{[INFO ]   version: \textcolor{keyword}{false}}
\DoxyCodeLine{[INFO ]}
\DoxyCodeLine{[INFO ] Program timers:}
\DoxyCodeLine{[INFO ]   drusilla\_select\_search: 0.000878s}
\DoxyCodeLine{[INFO ]   loading\_data: 0.004599s}
\DoxyCodeLine{[INFO ]   saving\_data: 0.003006s}
\DoxyCodeLine{[INFO ]   total\_time: 0.009234s}

\end{DoxyCode}


These options work in the same way for both the {\ttfamily mlpack\+\_\+approx\+\_\+kfn} and {\ttfamily mlpack\+\_\+kfn} programs.\doxysubsection{Final command-\/line program notes}\label{akfntutorial_cli_final_akfntut}
Both the {\ttfamily mlpack\+\_\+kfn} and {\ttfamily mlpack\+\_\+approx\+\_\+kfn} programs contain numerous options not fully documented in these short examples. You can run each program with the {\ttfamily --help} ({\ttfamily -\/h}) option for more information.\doxysection{Drusilla\+Select C++ class}\label{akfntutorial_cpp_ds_akfntut}
{\bfseries{mlpack}} provides a simple {\ttfamily Drusilla\+Select} C++ class that can be used inside of C++ programs to perform approximate furthest neighbor search. The class has only one template parameter---{\ttfamily Mat\+Type---which} specifies the type of matrix to be use. That means the class can be used with either dense data (of type {\ttfamily arma\+::mat}) or sparse data (of type {\ttfamily arma\+::sp\+\_\+mat}).

The following examples show simple usage of this class.\doxysubsection{Approximate furthest neighbors with defaults}\label{akfntutorial_cpp_ex1_ds_akfntut}
The code below builds a {\ttfamily Drusilla\+Select} model with default options on the matrix {\ttfamily dataset}, then queries for the approximate furthest neighbor of every point in the {\ttfamily queries} matrix.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/drusilla\_select.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat queries;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with defaults.}}
\DoxyCodeLine{DrusillaSelect<> ds(dataset);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Query the model, putting output into the following two matrices.}}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{ds.Search(queries, 1, neighbors, distances);}

\end{DoxyCode}


At the end of this code, both the {\ttfamily distances} and {\ttfamily neighbors} matrices will have number of columns equal to the number of columns in the {\ttfamily queries} matrix. So, each column of the {\ttfamily distances} and {\ttfamily neighbors} matrices are the distances or neighbors of the corresponding column in the {\ttfamily queries} matrix.\doxysubsection{Custom numbers of tables and projections}\label{akfntutorial_cpp_ex2_ds_akfntut}
The following example constructs a Drusilla\+Select model with 10 tables and 5 projections. Once that is done it performs the same task as the previous example.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/drusilla\_select.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat queries;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with custom parameters.}}
\DoxyCodeLine{DrusillaSelect<> ds(dataset, 10, 5);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Query the model, putting output into the following two matrices.}}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{ds.Search(queries, 1, neighbors, distances);}

\end{DoxyCode}
\doxysubsection{Accessing the candidate set}\label{akfntutorial_cpp_ex3_ds_akfntut}
The {\ttfamily Drusilla\+Select} algorithm merely scans the reference set and extracts a number of points that will be queried in a brute-\/force fashion when the {\ttfamily Search()} method is called. We can access this set with the {\ttfamily Candidate\+Set()} method. The code below prints the fifth point of the candidate set.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/drusilla\_select.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with custom parameters.}}
\DoxyCodeLine{DrusillaSelect<> ds(dataset, 10, 5);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Print the fifth point of the candidate set.}}
\DoxyCodeLine{std::cout << ds.CandidateSet().col(4).t();}

\end{DoxyCode}
\doxysubsection{Retraining on a new reference set}\label{akfntutorial_cpp_ex4_ds_akfntut}
It is possible to retrain a {\ttfamily Drusilla\+Select} model with new parameters or with a new reference set. This is functionally equivalent to creating a new model. The example code below creates a first {\ttfamily Drusilla\+Select} model using 3 tables and 10 projections, and then retrains this with the same reference set using 10 tables and 3 projections.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/drusilla\_select.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with initial parameters.}}
\DoxyCodeLine{DrusillaSelect<> ds(dataset, 3, 10);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Now retrain with different parameters.}}
\DoxyCodeLine{ds.Train(dataset, 10, 3);}

\end{DoxyCode}
\doxysubsection{Running on sparse data}\label{akfntutorial_cpp_ex5_ds_akfntut}
We can set the template parameter for {\ttfamily Drusilla\+Select} to {\ttfamily arma\+::sp\+\_\+mat} in order to perform furthest neighbor search on sparse data. This code below creates a {\ttfamily Drusilla\+Select} model using 4 tables and 6 projections with sparse input data, then searches for 3 approximate furthest neighbors.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/drusilla\_select.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::sp\_mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::sp\_mat querySet;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model on sparse data.}}
\DoxyCodeLine{DrusillaSelect<arma::sp\_mat> ds(dataset, 4, 6);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Search on query data.}}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{ds.Search(querySet, 3, neighbors, distances);}

\end{DoxyCode}
\doxysection{QDAFN C++ class}\label{akfntutorial_cpp_qdafn_akfntut}
{\bfseries{mlpack}} also provides a standalone simple {\ttfamily QDAFN} class for furthest neighbor search. The API for this class is virtually identical to the {\ttfamily Drusilla\+Select} class, and also has one template parameter to specify the type of matrix to be used (dense or sparse or other).

The following subsections demonstrate usage of the {\ttfamily QDAFN} class in the same way as the previous section\textquotesingle{}s examples for {\ttfamily Drusilla\+Select}.\doxysubsection{Approximate furthest neighbors with defaults}\label{akfntutorial_cpp_ex1_qdafn_akfntut}
The code below builds a {\ttfamily QDAFN} model with default options on the matrix {\ttfamily dataset}, then queries for the approximate furthest neighbor of every point in the {\ttfamily queries} matrix.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/qdafn.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat queries;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with defaults.}}
\DoxyCodeLine{QDAFN<> qd(dataset);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Query the model, putting output into the following two matrices.}}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{qd.Search(queries, 1, neighbors, distances);}

\end{DoxyCode}


At the end of this code, both the {\ttfamily distances} and {\ttfamily neighbors} matrices will have number of columns equal to the number of columns in the {\ttfamily queries} matrix. So, each column of the {\ttfamily distances} and {\ttfamily neighbors} matrices are the distances or neighbors of the corresponding column in the {\ttfamily queries} matrix.\doxysubsection{Custom numbers of tables and projections}\label{akfntutorial_cpp_ex2_qdafn_akfntut}
The following example constructs a QDAFN model with 15 tables and 30 projections. Once that is done it performs the same task as the previous example.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/qdafn.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat queries;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with custom parameters.}}
\DoxyCodeLine{QDAFN<> qdafn(dataset, 15, 30);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Query the model, putting output into the following two matrices.}}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{qdafn.Search(queries, 1, neighbors, distances);}

\end{DoxyCode}
\doxysubsection{Accessing the candidate set}\label{akfntutorial_cpp_ex3_qdafn_akfntut}
The {\ttfamily QDAFN} algorithm scans the reference set, extracting points that have been projected onto random directions. Each random direction corresponds to a single table. The {\ttfamily QDAFN} class stores these points as a vector of matrices, which can be accessed with the {\ttfamily Candidate\+Set()} method. The code below prints the fifth point of the candidate set of the third table.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/qdafn.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with custom parameters.}}
\DoxyCodeLine{QDAFN<> qdafn(dataset, 10, 5);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Print the fifth point of the candidate set.}}
\DoxyCodeLine{std::cout << ds.CandidateSet(2).col(4).t();}

\end{DoxyCode}
\doxysubsection{Retraining on a new reference set}\label{akfntutorial_cpp_ex4_qdafn_akfntut}
It is possible to retrain a {\ttfamily QDAFN} model with new parameters or with a new reference set. This is functionally equivalent to creating a new model. The example code below creates a first {\ttfamily QDAFN} model using 10 tables and 40 projections, and then retrains this with the same reference set using 15 tables and 25 projections.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/qdafn.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model with initial parameters.}}
\DoxyCodeLine{QDAFN<> qdafn(dataset, 3, 10);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Now retrain with different parameters.}}
\DoxyCodeLine{qdafn.Train(dataset, 10, 3);}

\end{DoxyCode}
\doxysubsection{Running on sparse data}\label{akfntutorial_cpp_ex5_qdafn_akfntut}
We can set the template parameter for {\ttfamily QDAFN} to {\ttfamily arma\+::sp\+\_\+mat} in order to perform furthest neighbor search on sparse data. This code below creates a {\ttfamily QDAFN} model using 20 tables and 60 projections with sparse input data, then searches for 3 approximate furthest neighbors.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/approx\_kfn/qdafn.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::sp\_mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::sp\_mat querySet;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the model on sparse data.}}
\DoxyCodeLine{QDAFN<arma::sp\_mat> qdafn(dataset, 20, 60);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Search on query data.}}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{qdafn.Search(querySet, 3, neighbors, distances);}

\end{DoxyCode}
\doxysection{KFN C++ class}\label{akfntutorial_cpp_ns_akfntut}
The extensive {\ttfamily Neighbor\+Search} class also provides a way to search for approximate furthest neighbors using a different, tree-\/based technique. For full documentation on this class, see the \doxyref{Neighbor\+Search tutorial}{p.}{nstutorial}. The {\ttfamily KFN} class is a convenient typedef of the {\ttfamily Neighbor\+Search} class that can be used to perform the furthest neighbors task with kd-\/trees.

In the following subsections, the {\ttfamily KFN} class is used in short code examples.\doxysubsection{Simple furthest neighbors example}\label{akfntutorial_cpp_ex1_ns_akfntut}
The {\ttfamily KFN} class has construction semantics similar to {\ttfamily Drusilla\+Select} and {\ttfamily QDAFN}. The example below constructs a {\ttfamily KFN} object (which will build the tree on the reference set), but note that the third parameter to the constructor allows us to specify our desired level of approximation. In this example we choose epsilon = 0.\+05. Then, the code searches for 3 approximate furthest neighbors.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/neighbor\_search/neighbor\_search.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference dataset.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat querySet;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the object, performing the default dual-\/tree search with}}
\DoxyCodeLine{\textcolor{comment}{// approximation level epsilon = 0.05.}}
\DoxyCodeLine{KFN kfn(dataset, KFN::DUAL\_TREE\_MODE, 0.05);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Search for approximate furthest neighbors.}}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{kfn.Search(querySet, 3, neighbors, distances);}

\end{DoxyCode}
\doxysubsection{Retraining on a new reference set}\label{akfntutorial_cpp_ex2_ns_akfntut}
Like the {\ttfamily QDAFN} and {\ttfamily Drusilla\+Select} classes, the {\ttfamily KFN} class is capable of retraining on a new reference set. The code below demonstrates this.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/neighbor\_search/neighbor\_search.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The original reference set we train on.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The new reference set we retrain on.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat newDataset;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the object with approximation level 0.1.}}
\DoxyCodeLine{KFN kfn(dataset, DUAL\_TREE\_MODE, 0.1);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Retrain on the new reference set.}}
\DoxyCodeLine{kfn.Train(newDataset);}

\end{DoxyCode}
\doxysubsection{Searching in single-\/tree mode}\label{akfntutorial_cpp_ex3_ns_akfntut}
The particular mode to be used in search can be specified in the constructor. In this example, we use single-\/tree search (as opposed to the default of dual-\/tree search).


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/neighbor\_search/neighbor\_search.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat querySet;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the object with approximation level 0.25 and in single tree search}}
\DoxyCodeLine{\textcolor{comment}{// mode.}}
\DoxyCodeLine{KFN kfn(dataset, SINGLE\_TREE\_MODE, 0.25);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Search for 5 approximate furthest neighbors.}}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{kfn.Search(querySet, 5, neighbors, distances);}

\end{DoxyCode}
\doxysubsection{Searching in brute-\/force mode}\label{akfntutorial_cpp_ex4_ns_akfntut}
If desired, brute-\/force search (\char`\"{}naive search\char`\"{}) can be used to find the furthest neighbors; however, the result will not be approximate---it will be exact (since every possibility will be considered). The code below performs exact furthest neighbor search by using the {\ttfamily KFN} class in brute-\/force mode.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <mlpack/methods/neighbor\_search/neighbor\_search.hpp>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }mlpack::neighbor;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// The reference set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat dataset;}
\DoxyCodeLine{\textcolor{comment}{// The query set.}}
\DoxyCodeLine{\textcolor{keyword}{extern} arma::mat querySet;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Construct the object in brute-\/force mode.  We can leave the approximation}}
\DoxyCodeLine{\textcolor{comment}{// parameter to its default (0) since brute-\/force will provide exact results.}}
\DoxyCodeLine{KFN kfn(dataset, NAIVE\_MODE);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Perform the search for 2 furthest neighbors.}}
\DoxyCodeLine{arma::Mat<size\_t> neighbors;}
\DoxyCodeLine{arma::mat distances;}
\DoxyCodeLine{kfn.Search(querySet, 2, neighbors, distances);}

\end{DoxyCode}
\doxysection{Further documentation}\label{akfntutorial_further_doc_akfntut}
For further documentation on the approximate furthest neighbor facilities offered by {\bfseries{mlpack}}, consult the following documentation\+:


\begin{DoxyItemize}
\item \doxyref{Neighbor\+Search tutorial (k-\/nearest-\/neighbors)}{p.}{nstutorial}
\item \doxyref{QDAFN class documentation}{p.}{classmlpack_1_1neighbor_1_1QDAFN}
\item \doxyref{Drusilla\+Select class documentation}{p.}{classmlpack_1_1neighbor_1_1DrusillaSelect}
\item \doxyref{Neighbor\+Search class documentation}{p.}{classmlpack_1_1neighbor_1_1NeighborSearch} 
\end{DoxyItemize}