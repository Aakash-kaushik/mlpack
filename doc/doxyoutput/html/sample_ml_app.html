<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mlpack: Sample C++ ML App for Windows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra-stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mlpack
   &#160;<span id="projectnumber">3.4.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sample C++ ML App for Windows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sample_intro"></a>
Introduction</h1>
<p>This tutorial will help you create a sample machine learning app using mlpack/C++. Although this app does not cover all the mlpack capabilities, it will walkthrough several APIs to understand how everything connects. This Windows sample app is created using Visual Studio, but you can easily adapt it to a different platform by following the provided source code.</p>
<dl class="section note"><dt>Note</dt><dd>Before starting, make sure you have built mlpack for Windows following this <a class="el" href="build_windows.html">Windows guide</a></dd></dl>
<h1><a class="anchor" id="sample_create_project"></a>
Creating the VS project</h1>
<ul>
<li>Open Visual Studio and create a new project (Windows Console Application)</li>
<li>For this sample, the project is named “sample-ml-app”</li>
</ul>
<h1><a class="anchor" id="sample_project_config"></a>
Project Configuration</h1>
<p>There are different ways in which you can configure your project to link with dependencies. This configuration is for x64 Debug Mode. If you need Release Mode, please change the paths accordingly (assuming you have built mlpack and dependencies in Release Mode).</p>
<ul>
<li>Right click on the project and select Properties, select the x64 Debug profile</li>
<li>Under C/C++ &gt; General &gt; Additional Include Directories add: <div class="fragment"><div class="line">- C:<a class="code" href="bindings_2R_2CMakeLists_8txt.html#a45548f086df473757b6a7c11f719387c">\boost\boost_1_71_0\lib\native\include</a></div>
<div class="line">- C:\mlpack\armadillo-9.800.3<a class="code" href="bindings_2R_2CMakeLists_8txt.html#a45548f086df473757b6a7c11f719387c">\include</a></div>
<div class="line">- C:\mlpack\mlpack-3.4.2<a class="code" href="bindings_2R_2CMakeLists_8txt.html#a45548f086df473757b6a7c11f719387c">\build\include</a></div>
<div class="ttc" id="abindings_2R_2CMakeLists_8txt_html_a45548f086df473757b6a7c11f719387c"><div class="ttname"><a href="bindings_2R_2CMakeLists_8txt.html#a45548f086df473757b6a7c11f719387c">include</a></div><div class="ttdeci">include(${CMAKE_SOURCE_DIR}/CMake/FindRModule.cmake) find_package(R 4.0) if(NOT R_FOUND) set(R_NOT_FOUND_MSG &quot;$</div><div class="ttdef"><b>Definition:</b> <a href="bindings_2R_2CMakeLists_8txt_source.html#l00028">CMakeLists.txt:28</a></div></div>
</div><!-- fragment --></li>
<li>Under Linker &gt; Input &gt; Additional Dependencies add: <div class="fragment"><div class="line">- C:\mlpack\mlpack-3.4.2\build\Debug\mlpack.lib</div>
</div><!-- fragment --></li>
<li>Under Build Events &gt; Post-Build Event &gt; Command Line add: <div class="fragment"><div class="line">- xcopy /y <span class="stringliteral">&quot;C:\mlpack\mlpack-3.4.2\build\Debug\mlpack.dll&quot;</span> $(OutDir)</div>
<div class="line">- xcopy /y <span class="stringliteral">&quot;C:\mlpack\mlpack-3.4.2\packages\OpenBLAS.0.2.14.1\lib\native\bin\x64\*.dll&quot;</span> $(OutDir)</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Recent versions of Visual Studio set "Conformance Mode" enabled by default. This causes some issues with the armadillo library. If you encounter this issue, disable "Conformance Mode" under C/C++ &gt; Language.</dd></dl>
<h1><a class="anchor" id="sample_app_goal"></a>
The app goal</h1>
<p>This app aims to exercise an end-to-end machine learning workflow. We will cover:</p>
<ul>
<li>Loading and preparing a dataset</li>
<li>Training (using Random Forest as example)</li>
<li>Computing the training accuracy</li>
<li>Cross-Validation using K-Fold</li>
<li>Metrics gathering (accuracy, precision, recall, F1)</li>
<li>Saving the trained model to disk</li>
<li>Loading the model</li>
<li>Classifying a new sample</li>
</ul>
<h1><a class="anchor" id="sample_headers_namespaces"></a>
Headers and namespaces</h1>
<p>For this app, we will need to include the following headers (i.e. add into stdafx.h):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core_8hpp.html">mlpack/core.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="random__forest_8hpp.html">mlpack/methods/random_forest/random_forest.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="random__dimension__select_8hpp.html">mlpack/methods/decision_tree/random_dimension_select.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="k__fold__cv_8hpp.html">mlpack/core/cv/k_fold_cv.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="accuracy_8hpp.html">mlpack/core/cv/metrics/accuracy.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="precision_8hpp.html">mlpack/core/cv/metrics/precision.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="recall_8hpp.html">mlpack/core/cv/metrics/recall.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;mlpack/core/cv/metrics/F1.hpp&quot;</span></div>
<div class="ttc" id="aaccuracy_8hpp_html"><div class="ttname"><a href="accuracy_8hpp.html">accuracy.hpp</a></div></div>
<div class="ttc" id="acore_8hpp_html"><div class="ttname"><a href="core_8hpp.html">core.hpp</a></div><div class="ttdoc">Include all of the base components required to write mlpack methods, and the main mlpack Doxygen docu...</div></div>
<div class="ttc" id="ak__fold__cv_8hpp_html"><div class="ttname"><a href="k__fold__cv_8hpp.html">k_fold_cv.hpp</a></div></div>
<div class="ttc" id="aprecision_8hpp_html"><div class="ttname"><a href="precision_8hpp.html">precision.hpp</a></div></div>
<div class="ttc" id="arandom__dimension__select_8hpp_html"><div class="ttname"><a href="random__dimension__select_8hpp.html">random_dimension_select.hpp</a></div></div>
<div class="ttc" id="arandom__forest_8hpp_html"><div class="ttname"><a href="random__forest_8hpp.html">random_forest.hpp</a></div></div>
<div class="ttc" id="arecall_8hpp_html"><div class="ttname"><a href="recall_8hpp.html">recall.hpp</a></div></div>
</div><!-- fragment --><p>Also, we will use the following namespaces:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>arma;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack.html">mlpack</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack_1_1tree.html">mlpack::tree</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemlpack_1_1cv.html">mlpack::cv</a>;</div>
<div class="ttc" id="anamespacemlpack_1_1cv_html"><div class="ttname"><a href="namespacemlpack_1_1cv.html">mlpack::cv</a></div><div class="ttdef"><b>Definition:</b> <a href="cv__base_8hpp_source.html#l00018">cv_base.hpp:18</a></div></div>
<div class="ttc" id="anamespacemlpack_1_1tree_html"><div class="ttname"><a href="namespacemlpack_1_1tree.html">mlpack::tree</a></div><div class="ttdoc">Trees and tree-building procedures.</div><div class="ttdef"><b>Definition:</b> <a href="binary__space__tree_2binary__space__tree_8hpp_source.html#l00020">binary_space_tree.hpp:20</a></div></div>
<div class="ttc" id="anamespacemlpack_html"><div class="ttname"><a href="namespacemlpack.html">mlpack</a></div><div class="ttdoc">Linear algebra utility functions, generally performed on matrices or vectors.</div><div class="ttdef"><b>Definition:</b> <a href="add__to__cli11_8hpp_source.html#l00021">add_to_cli11.hpp:21</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="sample_load_dataset"></a>
Loading the dataset</h1>
<p>First step is about loading the dataset. Different dataset file formats are supported, but here we load a CSV dataset, and we assume the labels don't require normalization.</p>
<dl class="section note"><dt>Note</dt><dd>Make sure you update the path to your dataset file. For this sample, you can simply copy "mlpack/tests/data/german.csv" and paste into a new "data" folder in your project directory.</dd></dl>
<div class="fragment"><div class="line">mat dataset;</div>
<div class="line"><span class="keywordtype">bool</span> loaded = <a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;data/german.csv&quot;</span>, dataset);</div>
<div class="line"><span class="keywordflow">if</span> (!loaded)</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="ttc" id="anamespacemlpack_1_1data_html_abbff2a667bf247e00b1fc09b7ca5f831"><div class="ttname"><a href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a></div><div class="ttdeci">bool Load(const std::string &amp;filename, arma::Mat&lt; eT &gt; &amp;matrix, const bool fatal=false, const bool transpose=true, const arma::file_type inputLoadType=arma::auto_detect)</div><div class="ttdoc">Loads a matrix from file, guessing the filetype from the extension.</div></div>
</div><!-- fragment --><p>Then we need to extract the labels from the last dimension of the dataset and remove the labels from the training set:</p>
<div class="fragment"><div class="line">Row&lt;size_t&gt; labels;</div>
<div class="line">labels = conv_to&lt;Row&lt;size_t&gt;&gt;::from(dataset.row(dataset.n_rows - 1));</div>
<div class="line">dataset.shed_row(dataset.n_rows - 1);</div>
</div><!-- fragment --><p>We now have our dataset ready for training.</p>
<h1><a class="anchor" id="sample_training"></a>
Training</h1>
<p>This app will use a Random Forest classifier. At first we define the classifier parameters and then we create the classifier to train it.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> numClasses = 2;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> minimumLeafSize = 5;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> numTrees = 10;</div>
<div class="line"> </div>
<div class="line">RandomForest&lt;GiniGain, RandomDimensionSelect&gt; rf;</div>
<div class="line"> </div>
<div class="line">rf = RandomForest&lt;GiniGain, RandomDimensionSelect&gt;(dataset, labels,</div>
<div class="line">    numClasses, numTrees, minimumLeafSize);</div>
</div><!-- fragment --><p>Now that the training is completed, we quickly compute the training accuracy:</p>
<div class="fragment"><div class="line">Row&lt;size_t&gt; predictions;</div>
<div class="line">rf.Classify(dataset, predictions);</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> correct = arma::accu(predictions == labels);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nTraining Accuracy: &quot;</span> &lt;&lt; (double(correct) / double(labels.n_elem));</div>
</div><!-- fragment --><h1><a class="anchor" id="sample_crossvalidation"></a>
Cross-Validating</h1>
<p>Instead of training the Random Forest directly, we could also use K-fold cross-validation for training, which will give us a measure of performance on a held-out test set. This can give us a better estimate of how the model will perform when given new data. We also define which metric to use in order to assess the quality of the trained model.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> k = 10;</div>
<div class="line">KFoldCV&lt;RandomForest&lt;GiniGain, RandomDimensionSelect&gt;, Accuracy&gt; cv(k, </div>
<div class="line">    dataset, labels, numClasses);</div>
<div class="line"><span class="keywordtype">double</span> cvAcc = cv.Evaluate(numTrees, minimumLeafSize);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nKFoldCV Accuracy: &quot;</span> &lt;&lt; cvAcc;</div>
</div><!-- fragment --><p>To compute other relevant metrics, such as Precision, Recall and F1:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> cvPrecision = Precision&lt;Binary&gt;::Evaluate(rf, dataset, labels);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nPrecision: &quot;</span> &lt;&lt; cvPrecision;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> cvRecall = Recall&lt;Binary&gt;::Evaluate(rf, dataset, labels);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nRecall: &quot;</span> &lt;&lt; cvRecall;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> cvF1 = F1&lt;Binary&gt;::Evaluate(rf, dataset, labels);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nF1: &quot;</span> &lt;&lt; cvF1;</div>
</div><!-- fragment --><h1><a class="anchor" id="sample_save_model"></a>
Saving the model</h1>
<p>Now that our model is trained and validated, we save it to a file so we can use it later. Here we save the model that was trained using the entire dataset. Alternatively, we could extract the model from the cross-validation stage by using <code>cv.Model()</code> </p>
<div class="fragment"><div class="line"><a class="code" href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">mlpack::data::Save</a>(<span class="stringliteral">&quot;mymodel.xml&quot;</span>, <span class="stringliteral">&quot;model&quot;</span>, rf, <span class="keyword">false</span>);</div>
<div class="ttc" id="anamespacemlpack_1_1data_html_accd1605a1d160c09ee75c93a587dc313"><div class="ttname"><a href="namespacemlpack_1_1data.html#accd1605a1d160c09ee75c93a587dc313">mlpack::data::Save</a></div><div class="ttdeci">bool Save(const std::string &amp;filename, const arma::Mat&lt; eT &gt; &amp;matrix, const bool fatal=false, bool transpose=true, arma::file_type inputSaveType=arma::auto_detect)</div><div class="ttdoc">Saves a matrix to file, guessing the filetype from the extension.</div></div>
</div><!-- fragment --><p>We can also save the model in <code>bin</code> format ("mymodel.bin") which would result in a smaller file.</p>
<h1><a class="anchor" id="sample_load_model"></a>
Loading the model</h1>
<p>In a real-life application, you may want to load a previously trained model to classify new samples. We load the model from a file using:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacemlpack_1_1data.html#abbff2a667bf247e00b1fc09b7ca5f831">mlpack::data::Load</a>(<span class="stringliteral">&quot;mymodel.xml&quot;</span>, <span class="stringliteral">&quot;model&quot;</span>, rf);</div>
</div><!-- fragment --><h1><a class="anchor" id="sample_classify_sample"></a>
Classifying a new sample</h1>
<p>Finally, the ultimate goal is to classify a new sample using the previously trained model. Since the Random Forest classifier provides both predictions and probabilities, we obtain both.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a test sample containing only one point.  Because Armadillo is</span></div>
<div class="line"><span class="comment">// column-major, this matrix has one column (one point) and the number of rows</span></div>
<div class="line"><span class="comment">// is equal to the dimensionality of the point (23).</span></div>
<div class="line">mat sample(<span class="stringliteral">&quot;2; 12; 2; 13; 1; 2; 2; 1; 3; 24; 3; 1; 1; 1; 1; 1; 0; 1; 0; 1;&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot; 0; 0; 0&quot;</span>);</div>
<div class="line">mat probabilities;</div>
<div class="line">rf.Classify(sample, predictions, probabilities);</div>
<div class="line">u64 result = predictions.at(0);</div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;\nClassification result: &quot;</span> &lt;&lt; result &lt;&lt; <span class="stringliteral">&quot; , Probabilities: &quot;</span> &lt;&lt;</div>
<div class="line">    probabilities.at(0) &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; probabilities.at(1);</div>
</div><!-- fragment --><h1><a class="anchor" id="sample_app_conclussion"></a>
Final thoughts</h1>
<p>Building real-life applications and services using machine learning can be challenging. Hopefully, this tutorial provides a good starting point that covers the basic workflow you may need to follow while developing it. You can take a look at the entire source code in the provided sample project located here: "doc/examples/sample-ml-app". </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
</body>
<script type="text/javascript">
var x = document.querySelectorAll("img.formulaDsp");
var i;
for (i = 0; i < x.length; i++)
{
  x[i].width = x[i].offsetWidth / 4;
}
</script>
</html>
